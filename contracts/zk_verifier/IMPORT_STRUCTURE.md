# ZK Verifier Import Structure

## Module Organization

```
zk_verifier/
├── src/
│   ├── lib.rs          (main exports)
│   ├── vk.rs           (G1Point, G2Point, VerificationKey - canonical definitions)
│   ├── verifier.rs     (Proof, re-exports G1Point/G2Point from vk)
│   ├── helpers.rs      (ZkAccessHelper, MerkleVerifier)
│   ├── audit.rs        (AuditRecord, AuditTrail)
│   ├── events.rs       (AccessRejectedEvent, etc.)
│   └── plonk.rs        (PlonkVerifier)
└── tests/
    ├── bench_verify.rs
    ├── test_nonce_replay.rs
    └── test_zk_access.rs
```

## Type Definitions

### Canonical Definitions (vk.rs)
- `G1Point` - BN254 G1 curve point
- `G2Point` - BN254 G2 curve point  
- `VerificationKey` - Groth16/PLONK verification key

### Proof Types (verifier.rs)
- `Proof` - Contains G1Point and G2Point (uses types from vk.rs)
- `ProofValidationError` - Validation error enum
- Re-exports: `G1Point`, `G2Point` from vk.rs

### Contract Types (lib.rs)
- `AccessRequest` - Proof verification request
- `ContractError` - Contract error enum
- `BatchVerificationSummary` - Batch verification result
- `BatchAccessAuditEvent` - Batch audit event

## Public API Exports (lib.rs)

```rust
// Module exports
pub mod events;
pub mod plonk;
pub mod verifier;
pub mod vk;

// Type exports from submodules
pub use crate::audit::{AuditRecord, AuditTrail};
pub use crate::events::AccessRejectedEvent;
pub use crate::helpers::{MerkleVerifier, ZkAccessHelper};
pub use crate::verifier::{Bn254Verifier, PoseidonHasher, Proof, ProofValidationError, ZkVerifier};
pub use crate::vk::{G1Point, G2Point, VerificationKey};

// Contract types (defined in lib.rs)
pub use AccessRequest;
pub use BatchAccessAuditEvent;
pub use BatchVerificationSummary;
pub use ContractError;

// Contract client (generated by soroban-sdk)
pub use ZkVerifierContractClient;
```

## Test Import Patterns

### Pattern 1: Import from vk module (canonical)
```rust
use zk_verifier::vk::{G1Point, G2Point, VerificationKey};
```
Used in: `test_zk_access.rs`

### Pattern 2: Import from verifier module (re-exported)
```rust
use zk_verifier::verifier::{G1Point, G2Point, Proof};
```
Used in: `test_nonce_replay.rs`

### Pattern 3: Import from root
```rust
use zk_verifier::{AccessRequest, ContractError, ZkVerifierContract, ZkVerifierContractClient};
use zk_verifier::{MerkleVerifier, ZkAccessHelper};
use zk_verifier::PoseidonHasher;
```
Used in: All test files

## Import Resolution

All import patterns work because:

1. **vk module is public** → `use zk_verifier::vk::{G1Point, G2Point}` ✅
2. **verifier module is public** → `use zk_verifier::verifier::{G1Point, G2Point}` ✅
3. **Types re-exported at root** → `use zk_verifier::{AccessRequest, ContractError}` ✅
4. **Contract client auto-generated** → `use zk_verifier::ZkVerifierContractClient` ✅

## Verification

To verify all imports work:

```bash
# Check that all modules compile
cargo check -p zk_verifier

# Check that tests compile
cargo check -p zk_verifier --tests

# Run clippy on all targets (including tests)
cargo clippy -p zk_verifier --all-targets

# Run all tests
cargo test -p zk_verifier
```

## Key Design Decisions

1. **Single Source of Truth**: G1Point and G2Point are defined only in `vk.rs`
2. **Re-exports for Convenience**: `verifier.rs` re-exports these types for ergonomics
3. **Public Modules**: Both `vk` and `verifier` modules are public for flexible imports
4. **Root-level Exports**: Common types exported at crate root for convenience
5. **Contract Client**: Auto-generated client is re-exported for test access

## No Breaking Changes

All changes are additive:
- ✅ Existing code continues to work
- ✅ New exports enable test compilation
- ✅ No types removed or renamed
- ✅ No API changes to existing functions
